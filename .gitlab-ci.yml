
#npm_check:
 # needs:
 #   - npm_install


stages:
  - test

lighthouse:
  image: registry.gitlab.com/gitlab-ci-utils/lighthouse:latest
  stage: test
  script:
    # Start a local static server, serving the site in the ./site/ folder,
    # piping the output to null so it is not displayed, and waiting
    # until the server is available (port 3000 is the default for serve).
    - serve ./site/ > /dev/null 2>&1 & wait-on http://localhost:3000/
    # Run lighthouse against the test site in headless mode, but otherwise
    # with the default settings.
    - lighthouse http://localhost:3000 --chrome-flags="--headless"
  artifacts:
    # Always save artifacts. This is needed if lighthouse is run configured
    # to fail on certain criteria, and will ensure the report is saved.
    when: always
    # Save the lighthouse report, which by default is named for the site
    # analyzed and the current time.
    paths:
      - localhost*.html



#current ref : https://gitlab.com/gitlab-ci-utils/lighthouse
# ref for custom runner + lhci https://medium.com/1mgofficial/integrating-lighthouse-ci-in-your-gitlab-ci-cd-pipeline-1233b9223e5c